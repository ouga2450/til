---
tags:
  - 日記
  - PermanentNote
aliases: 
UID: 2025-08-07T16-04-44
---
[日記](日記.md)
[02_モデルスペック](02_モデルスペック.md)

# RSpecを記述する


```
require 'rails_helper'

RSpec.describe Task, type: :model do
  describe 'バリデーションチェック' do
    it '設定したすべてのバリデーションが機能しているか' do
      task = build(:task)
      expect(task).to be_valid
      # バリデーションがすべて通る場合はエラーがないことを確認
      expect(task.errors).to be_empty
    end
    # 残りのテストパターンを書いていく
    it 'titleがない場合にバリデーションが機能してinvalidになるか' do
      task_without_title = build(:task, title: "")
      expect(task_without_title).to be_invalid
      expect(task_without_title.errors[:title]).to eq["can't be blank"]
    end
    it 'statusがない場合にバリデーションが機能してinvalidになるか' do
      task_without_status = build(:task, status: "")
      expect(task_without_status).to be_invalid
      expect(task_without_status.errors[:status]).to eq["can't be blank"]
    end
    it 'titleが重複している場合にuniqueのバリデーションが機能してinvalidになるか' do
      task = create(:task)
      task_with_duplicate_title = build(:task, title: task.title)
      expect(task_with_duplicate_title).to be_invalid
      expect(task_with_duplicate_title.errors[:title]).to eq(["has already been taken"])
   end
    it 'titleが重複しない場合にvalidになるか' do
      task = create(:task)
      task_with_unique_title = build(:task, title: "another_title")
      expect(task_with_unique_title).to be_valid
      expect(task_with_unique_title.errors).to be_empty
    end
  end
end
```

```
FactoryBot.define do
  factory :user do
    sequence(:email) { |n| "user_#{n}@example.com" }
    password { "password" }
    password_confirmation { "password" }
  end
end
```

```
FactoryBot.define do
  factory :task do
    sequence(:title, "title_1")
    content { "content" }
    status { :todo }
    deadline { 1.week.from_now }
    association :user
  end
end
```


モデルtaskのバリデーションからパターンを考える
#### 失敗パターン

- titleがない場合にバリデーションが機能してinvalidになるか
- statusがない場合にバリデーションが機能してinvalidになるか
- titleが被った場合にuniqueのバリデーションが機能してinvalidになるか

#### 成功パターン

失敗パターンに当てはまらない場合に成功になります。

- 設定したすべてのバリデーションが機能しているか（titleとstatusがあること、titleが被ってないこと）
- titleが被らない場合にバリデーションエラーが起きないか

factorybotでuser,taskのデータを作成する
userとtaskはアソシエーションの関係にあるのでtaskのmodel sped記述をしたが、userのfactory botも記述する
テストではbuildメソッドにして、実際にはデータベースに保存しないようにした

it 'titleが重複しない場合にvalidになるか' do
      task = create(:task)
      task_with_unique_title = build(:task, title: "another_title")
      expect(task_with_unique_title).to be_valid
      expect(task_with_unique_title.errors).to be_empty
    end

最初のtaskで作ったデータとタイトルが一致するように task_with_unique_titleを作成することで
タイトル重複のバリデーションを起こしている


