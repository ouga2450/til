---
tags:
  - 日記
  - PermanentNote
aliases: 
UID: 2025-08-06T16-29-36
---
[日記](日記.md)
[02_モデルスペック](02_モデルスペック.md)

- be_empty
  be_emptyマッチャーは、配列や文字列、ハッシュなどが空であるかどうか検証する
```
expect(テスト対象の配列).to be_empty
expect(テスト対象の文字列).to be_empty
expect(テスト対象のハッシュ).to be_empty
```
  配列が空の場合や、文字列が空の場合、ハッシュが空の場合にテストが成功する
  要素や文字列、キーと値のペアが存在しない状態を表す
  
- be_valid
  be_validマッチャ―は、オブジェクトがバリデーションに通るか検証する
  主にActive Recordモデルのテストで使用

```
expect(テスト対象のオブジェクト).to be_valid
```
オブジェクトがバリデーションに通っている場合にテストが成功する
オブジェクトの属性値が必要なバリデーションルールを満たしているので、エラーが発生していない状態

be_emptyと組み合わせて、エラーメッセージの格納する配列が空であることも追加でテストとして記載するとより正確なテストを書くことができる
```
expect(テスト対象のオブジェクト).to be_valid
expect(テスト対象のオブジェクトのエラーの配列).to be_empty
```

- be_invalid
  be_invalidマッチャ―は、be_validの逆でオブジェクトがバリデーションに通らない状態であることを検証するために使用する
```
expect(object).to be_invalid
```

objectがバリデーションに合格しない場合にテストが成功する
オブジェクトの属性値が必要なバリデーションルールを満たしていないので、エラーが発生している状態

## factory_bot
RSpecや他のテストフレームワークで使用されるRubyのライブラリであり、テストデータの生成を簡素化するために使用される
テストケースで必要なオブジェクトやデータを効率的に作成するためのツールとして広く利用されている
## factory botでのデータの定義方法

オブジェクトのファクトリを定義できる
ファクトリを一度定義すると、テストケース内でそのファクトリを使用してオブジェクトを簡単に作成できる
```
FactoryBot.define do
  factory :user do
    name { "らんてくん" }
    sequence(:email) { |n| "runteq_#{n}@example.com" }
    age { 3 }
  end
end
```
この定義では:userという名前のファクトリが作成され、name,email,ageという属性をもつユーザーオブジェクトを生成する
sequenceという連番を生成する機能がある

sequenceはユニーク値を生成したいときに使用する
バリデーション等で重複を許していないカラムを含むオブジェクトで使用する
例：emailはユニーク値

sequenceの書き方
１：
sequence(:email) { |n| "runteq_#{n}@example.com" }
２：
sequence(:title, "title_1")

ブロックで囲む書き方と引数を使う書き方
引数を使用するときは末尾が変更する数字の時

ブロックを渡さずに第二引数を渡すと、 .next が呼ばれるようになっている
→
title_1'.next = title_2
'user_#{n}@example.com'.next = "user_{n}@example.con"
mがnになってしまう
末尾にたいして適用されるので末尾以外の数字を変更したい場合はブロックで囲う

## factory botでのデータの作成

- createメソッド
  データベースに実際にオブジェクトを保存するメソッド
  データベースにレコードを作成してからそれを利用するようなテストケースで使用される
```
user = FactoryBot.create(:user)
or
user = create(:user)
```
データの中身を書き換えたいときは下記のようにデータを上書きしてデータ生成してデータベースに保存することもできる
```
user = FactoryBot.create(:user, name: "RUNTEQ")
or
user = create(:user, name: "RUNTEQ")
```

- buildメソッド
  データベースに保存せずにオブジェクトを作成するためのメソッド
  buildメソッドを使用すると、作成したオブジェクトはデータベースに保存されず、一時的なオブジェクトとして存在する
  このオブジェクトは通常、データベースに保存する必要がない場合や関連オブジェクトの作成など一時的なオブジェクトを作成する場合に使用される
```
user = FactoryBot.build(:user)
or
user = build(:user)
```

データの中身を書き換える場合
```
user = FactoryBot.build(:user, name: "RUNTEQ")
or
user = build(:user, name: "RUNTEQ")
```

## 実践フェーズ
modelのバリデーションを確認する
```
 validates :title, presence: true, uniqueness: true
  validates :status, presence: true
```
- 失敗パターン
titleがない場合にバリデーションが機能してinvalidになるか
titleが重複している場合にバリデーションが機能してinvalidになるか
statusがない場合にuniqueのバリデーションが機能してinvalidになるか

- 成功パターン
設定したすべてのバリデーションが機能しているか（titleとstatusがあること、titleが被ってないこと）
titleが被らない場合にバリデーションエラーが起きないか

### テストケースを記載
洗い出したテストパターンとテスト種類をグループ化して記載する


