---
tags:
  - 日記
  - PermanentNote
aliases: 
UID: 2025-08-08T08-09-15
---
[日記](日記.md)

# システムスペック

## インプット
### system spec
ブラウザやシステムとのやり取りをシミュレートしてテストを実行できる
ブラウザの操作、フォームの入力、ページの遷移など

### capybara
RSpecで統合テストを実行するためのDSL（ドメイン固有言語）
主にWebアプリケーションのテストをシミュレートするために使用
Capybataは、ブラウザとのやり取りをシミュレートすることで、ユーザーが実際に行うであろう操作（クリック、フォーム入力、ページ遷移）をテストコード内で再現できる

### capybaraのメソッド
- visit
  指定したURL、pathヘルパーにアクセスする
  
- click_on, click_link, click_button
  対象のリンクやボタンをクリックする

- fill_in
  フォームの入力

- find
  CSSセレクタで指定した要素を探す

- select
  セレクトボックスからオプションを選択

- have_content
  指定した要素内に、テキストが存在することを検証

### 処理の共通化
#### 変数宣言
- let
  RSpecでよく使われるメソッドで、テストケース内で使用する変数を定義
  参照された時に初めて変数が作られる
- let!
  letとは対照的に定義された時点で変数を作成
  参照した際には作成された変数が読み込まれる
#### 事前処理
- before
  各テストケースの実行前に共通のセットアップコードを実行
  beforeを使用することで、テストケースごとに繰り返し実行するセットアップコードを簡潔に記述できる
#### 処理のmodule化
RSpecは記載コードもrubyなので、処理の共通化ができる
- spec/support/login_macros.rb`
```
module LoginMacros
  def login(user)
    visit login_path
    fill_in 'メールアドレス', with: user.email
    fill_in 'パスワード', with: user.password
    click_on 'ログイン'
  end
end
```

- 利用ファイルでincludeする
  moduleに切り出した処理を以下のようにincludeして利用します。

```
RSpec.describe 'hogehoge', type: :system do
  include LoginMacros

  it 'ログインした後に...' do
    user = User.create(email: 'runteq@example.com', password: 'password')
    login(user)
    # ログイン後のテストを書く
  end
end
```

## 実装フェーズ
### gemのインストール

group :test do
  gem 'capybara'
  gem 'selenium-webdriver'
  gem "webdrivers"
end

### エラーの発生
docker webが立ち上がらない
docker compose logs webより状態を把握
Could not find gem 'capybara' in locally installed gems.
gemインストールにて記述した内容が原因と判明
gemのインストールのためにはwebの立ち上げが必要
docker compose run --rm web bashでコンテナを立ち上げ、bundle installを実行
解決

### formatの設定
```
--format documentation
```

### webdriberの設定
